<!--
Sync Impact Report:
Version: 1.0.0 (新規作成)
作成日: 2025-01-27
最終更新日: 2025-01-27

変更内容:
- 新規作成: プロジェクト憲章 v1.0.0
- 原則追加: セキュリティ、テスト、コード品質、アーキテクチャ、デプロイ、データ管理

テンプレート更新状況:
- ✅ 更新済み: .specify/templates/plan-template.md (Constitution Checkセクションを追加)
- ✅ 更新済み: .specify/templates/spec-template.md (Security Requirements、Testing Requirementsセクションを追加)
- ✅ 更新済み: .specify/templates/tasks-template.md (セキュリティ、コード品質タスクを追加)
- ⚠ 未確認: .specify/templates/commands/*.md (コマンドテンプレートファイルが存在しないため、更新不要)

TODO:
- なし（すべての依存テンプレートファイルを更新済み）
-->

# プロジェクト憲章

**プロジェクト名**: 家計簿Webアプリ (Kakeibo App)  
**バージョン**: 1.0.0  
**制定日**: 2025-01-27  
**最終更新日**: 2025-01-27

## 序文

この憲章は、家計簿Webアプリケーションの開発、保守、運用における非妥協的な原則とガイドラインを定義します。すべての開発活動は、これらの原則に従って実施されなければなりません。

## 原則

### 原則1: セキュリティ第一

**必須事項**:
- すべてのWebリクエストに対してCSRF保護を実装し、Laravelの標準CSRFミドルウェアを使用する
- すべてのユーザー入力は適切にエスケープされ、XSS攻撃を防ぐ（Bladeテンプレートの自動エスケープを活用）
- 認証が必要なすべてのリソースに対して認証チェックを実装する
- 認可はPolicyクラスを使用して実装し、コントローラーで`authorize()`メソッドを呼び出す
- 本番環境ではHTTPSを強制する
- パスワードはハッシュ化され、平文で保存・送信されない
- SQLインジェクション対策としてEloquent ORMまたはパラメータ化クエリを使用する

**根拠**: 家計簿アプリケーションは個人の財務情報を扱うため、セキュリティ侵害は重大な影響を及ぼします。セキュリティは後から追加するものではなく、設計段階から組み込まれる必要があります。

### 原則2: 包括的なテスト

**必須事項**:
- すべての新機能には対応するテスト（ユニットテストまたは機能テスト）を含める
- テストはCI/CDパイプラインで自動実行され、すべてのテストが成功するまでデプロイをブロックする
- テストは独立して実行可能で、外部依存関係（データベース、API）をモックまたはセットアップする
- テストデータはFactoryクラスを使用して生成する
- テストは明確な名前を持ち、何をテストしているかが分かるようにする

**根拠**: テストは回帰を防ぎ、リファクタリングの安全性を保証します。自動化されたテストにより、変更の影響を迅速に検出できます。

### 原則3: コード品質と一貫性

**必須事項**:
- すべてのコードはLaravel Pintを使用してフォーマットされ、PSR-12コーディング標準に準拠する
- コードレビューはすべてのプルリクエストで必須とする
- 関数とメソッドは単一責任の原則に従い、長さは50行を超えない（例外は正当化が必要）
- クラス名、メソッド名、変数名は説明的で、略語は避ける
- コメントは「なぜ」を説明し、「何を」はコード自体が示すべき

**根拠**: 一貫したコード品質は保守性を向上させ、チーム開発での協力を容易にします。

### 原則4: アーキテクチャの明確性

**必須事項**:
- MVCパターンに従い、ビジネスロジックはコントローラーではなくServiceクラスに配置する
- データベースアクセスはEloquentモデルを通じて行い、生のSQLクエリは避ける（パフォーマンス要件がある場合は正当化が必要）
- 認可ロジックはPolicyクラスに集約する
- 再利用可能なロジックはServiceクラスまたはヘルパー関数として実装する
- 依存性注入を使用し、直接的なインスタンス化を避ける

**根拠**: 明確なアーキテクチャはコードの理解を容易にし、変更の影響範囲を限定します。

### 原則5: 安全なデプロイ

**必須事項**:
- すべてのデプロイはGitHub Actionsを通じて自動化される
- デプロイ前にテストとコードスタイルチェックが実行され、失敗時はデプロイをブロックする
- ゼロダウンタイムデプロイ方式を採用し、リリース管理とロールバック機能を維持する
- データベースマイグレーションは自動実行され、`--force`フラグを使用する
- デプロイ後はキャッシュをクリアし、最適化コマンドを実行する

**根拠**: 自動化された安全なデプロイプロセスは、人的ミスを減らし、本番環境の安定性を確保します。

### 原則6: データ整合性

**必須事項**:
- データベーススキーマの変更はマイグレーションファイルで管理し、直接的なSQL実行は避ける
- 関連データの更新はトランザクション内で実行し、整合性を保証する
- 外部キー制約を使用して参照整合性を確保する
- ソフトデリートが必要な場合はEloquentの`SoftDeletes`トレイトを使用する
- データのバックアップ戦略を維持し、定期的に検証する

**根拠**: データ整合性は家計簿アプリケーションの信頼性の基盤です。不整合はユーザーの信頼を損ないます。

## ガバナンス

### 修正手順

この憲章の修正は以下の手順に従います:

1. 修正提案をイシューまたはプルリクエストで文書化する
2. 影響を受ける原則の変更理由と影響範囲を明確にする
3. チームメンバーのレビューと承認を得る
4. バージョン番号を適切に更新する（セマンティックバージョニング）
5. 依存テンプレートファイルを更新する

### バージョニング

バージョンはセマンティックバージョニング（MAJOR.MINOR.PATCH）に従います:

- **MAJOR**: 後方互換性のない原則の削除または再定義
- **MINOR**: 新しい原則の追加または既存原則の大幅な拡張
- **PATCH**: 明確化、表現の改善、誤字脱字の修正

### コンプライアンスレビュー

- すべてのプルリクエストは憲章の原則に準拠しているかレビューされる
- 定期的（四半期ごと）に憲章の有効性と実用性を評価する
- 原則違反が検出された場合、修正が完了するまでマージをブロックする

## 適用範囲

この憲章は以下のすべてに適用されます:

- アプリケーションコード（PHP、JavaScript、CSS）
- データベーススキーマとマイグレーション
- テストコード
- ドキュメント
- CI/CDパイプライン設定
- インフラストラクチャ設定

## 例外

原則からの例外は、以下の条件をすべて満たす場合にのみ許可されます:

1. 例外の理由が明確に文書化されている
2. 代替案が検討され、却下理由が記録されている
3. 例外の影響範囲が限定されている
4. チームメンバーの承認を得ている

## 変更履歴

- **v1.0.0** (2025-01-27): 初版作成
